Lesson_9: starup, shutdown and instance recovery
-----------------------------------------------

========================
1. Instance vs Database:
======================== 
  Instance = memory(SGA) + background processes
  Database = datafiles + control files + redo logs
  
startup = bringing the instance up and attaching it to the database
user connect to instance, instance access the database.

================
2. startup pahse
===============
 
 1. NOMOUNT
 ----------
	. allocates SGA
	. starts background processes
	. reads init parameters
  what is not accessed:
    . no control files
	. no datafiles
	. no redo logs
 
 ** prepare memory and processes
 
 2. MOUNT
 ---------
   . opens control files
   . knows database structure
   . knows locations of datafiles and redo logs 
  what is not accessed:
   . data inside tables
 
 ** oracle now knows what the database looks like 
 
 3. OPEN
 -------
   . opens datafiles
   . opens redo logs
   . database becomes usable 
   
 ** make data accessible to users
 
========================== 
3. clean shutdown vs crash 
==========================

 clean shutdown:
 --------------- 
  before shutdown:
   1. DBWR writes dirty buffers
   2. checkpoint ensures consistency
   3. datafiles and control files are synchronized
  result:
   . no recovery needed at next startup
   . startup is fast
  
  crash/abort/instance failure
  ----------------------------
   before crash:
    1. diry buffers may exist in memory
	2. redo is safely written to disk 
    3. datafiles may be inconsistent	
 result:
 ----- 
    . Instance recovery required on next startup

============================
4. what is instance recovery
============================
 
 oracle using redo to make datafiles consistent
 
 steps:
 -----
  1. read redo logs
  2. roll forward committed changes
  3. roll back uncommitted changes
  4. open database
 
 * Happens automatically during startup

====================================
5. why instance recovery time varies
====================================

 recovery time depends on:
  1. amount of redo generated since last checkpoint
  2. frequency of checkpoints
  3. workload before crash
 
* more redo after last checkpoint -> longer recovery

========================================
6. why startup can feel slow after crash
========================================
 common reasons:
  1. large redo to apply
  2. infrequent checkpoints
  3. heavy workload before crash
  4. slow redo disks
  
 * slow startup usually means recovery work not a problem 

=========================
7. DBA instinct(critical)
=========================
 
 when startup is slow after crash

  . read alert log
  . let recovery finish 
  . understand what oracle is doing 

