========================================
DBA-P2-LAB-03
Users, Roles & Privileges
========================================

-- Connect as SYSDBA
sqlplus / as sysdba

----------------------------------------
-- 1. Create a test user
----------------------------------------
CREATE USER lab_user
IDENTIFIED BY lab123
DEFAULT TABLESPACE users
TEMPORARY TABLESPACE temp
QUOTA 50M ON users;

----------------------------------------
-- 2. Try login (will fail)
----------------------------------------
-- Expected: ORA-01045 (no CREATE SESSION)

----------------------------------------
-- 3. Grant CREATE SESSION
----------------------------------------
GRANT CREATE SESSION TO lab_user;

----------------------------------------
-- 4. Create a role
----------------------------------------
CREATE ROLE lab_role;

----------------------------------------
-- 5. Grant privileges to role
----------------------------------------
GRANT CREATE TABLE TO lab_role;
GRANT CREATE VIEW  TO lab_role;

----------------------------------------
-- 6. Grant role to user
----------------------------------------
GRANT lab_role TO lab_user;

----------------------------------------
-- 7. Verify user privileges
----------------------------------------
SELECT * FROM dba_sys_privs
WHERE grantee = 'LAB_ROLE';

----------------------------------------
-- 8. Verify role granted to user
----------------------------------------
SELECT * FROM dba_role_privs
WHERE grantee = 'LAB_USER';

----------------------------------------
-- 9. Login as lab_user and test
----------------------------------------
CONNECT lab_user/lab123

CREATE TABLE test_tab (
  id NUMBER
);

----------------------------------------
-- 10. Cleanup (important)
----------------------------------------
CONNECT / AS SYSDBA

DROP USER lab_user CASCADE;
DROP ROLE lab_role;

----------------------------------------
-- End of Lab-3
----------------------------------------

SQL> run
  1  create user lab_user
  2  identified by lab123
  3  default tablespace users
  4  temporary tablespace temp
  5* quota 50M on users
create user lab_user
            *
ERROR at line 1:
ORA-65096: invalid common user or role name


SQL> 

Perfect â€” this error is expected in a CDB/PDB setup. You didnâ€™t do anything wrong.

Letâ€™s fix it cleanly and correctly, and Iâ€™ll also explain why it happened (briefly).

âŒ Why you got ORA-65096
ORA-65096: invalid common user or role name


You are currently connected to the CDB root.

In a multitenant database:

CDB$ROOT

Only common users allowed

Common users must start with C##

PDB

Normal users allowed (like LAB_USER)

You tried to create a local user in the root, which Oracle blocks.

SQL> show con_name

CON_NAME
------------------------------
CDB$ROOT
SQL> show pdbs;

    CON_ID CON_NAME			  OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
	 2 PDB$SEED			  READ ONLY  NO
	 3 PDB1 			  READ WRITE NO
SQL> alter session set container=PDB1
  2  ;

Session altered.

SQL> 
SQL> 
SQL> sho con_name;

CON_NAME
------------------------------
PDB1
SQL> create user lab_user
  2  identified by lab123
  3  default tablespace users
  4  temporary tablespace temp
  5  quota 50m on users
  6  
SQL> run
  1  create user lab_user
  2  identified by lab123
  3  default tablespace users
  4  temporary tablespace temp
  5* quota 50m on users

User created.

SQL> create role lab_role;   

Role created.

SQL> grant create table to lab_role;

Grant succeeded.

SQL> grant create view to lab_role;

Grant succeeded.

SQL> grant lab_role to lab_user;

Grant succeeded.

SQL> 

SQL> connect lab_user/lab123
ERROR:
ORA-01017: invalid username/password; logon denied


Warning: You are no longer connected to ORACLE.
SQL> 

âŒ Why login failed (ORA-01017)
ORA-01017: invalid username/password; logon denied


In your case, this is NOT a wrong password.

ðŸ‘‰ The real reason is simpler:

You did not grant CREATE SESSION to the user

In Oracle:

User can exist

User cannot log in without CREATE SESSION

Oracle misleadingly throws ORA-01017

This is a classic DBA interview + real-life gotcha.

SQL> revoke create session from lab_user;

Revoke succeeded.

SQL> revoke create session from lab_group;
revoke create session from lab_group
                           *
ERROR at line 1:
ORA-01917: user or role 'LAB_GROUP' does not exist


SQL> edit
Wrote file afiedt.buf

  1* revoke create session from lab_role
SQL> run
  1* revoke create session from lab_role

Revoke succeeded.

SQL> grant create session to lab_role;

Grant succeeded.

SQL> select * from dba_sys_privs
  2  where grantee = 'lab_role';

no rows selected

SQL> select * from dba_role_privs
  2  wehre grantee = 'LAB_USER';
wehre grantee = 'LAB_USER'
      *
ERROR at line 2:
ORA-00933: SQL command not properly ended


SQL> !clear


SQL> select * from dba_sys_privs
  2  where grantee = 'LAB_ROLE';

GRANTEE  PRIVILEGE				  ADM COM INH
-------- ---------------------------------------- --- --- ---
LAB_ROLE CREATE TABLE				  NO  NO  NO
LAB_ROLE CREATE VIEW				  NO  NO  NO
LAB_ROLE CREATE SESSION 			  NO  NO  NO

SQL> select * from dba_role_privs
  2  where grantee = 'LAB_USER';

GRANTEE
--------------------------------------------------------------------------------
GRANTED_ROLE
--------------------------------------------------------------------------------
ADM DEL DEF COM INH
--- --- --- --- ---
LAB_USER
LAB_ROLE
NO  NO	YES NO	NO


SQL> conn lab_user/lab123@PDB1
Connected.
SQL> sho user
USER is "LAB_USER"
SQL> create table test_tab (id number);

Table created.

SQL> exit 
Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.8.0.0.0
[oracle@srv1 ~]$ 

SQL> alter session set container=PDB1
  2  ;

Session altered.

SQL> 
SQL> drop user lab_user cascade;

User dropped.

SQL> drop role lab_role;

Role dropped.

SQL> 
